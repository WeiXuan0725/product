/* --- product_img.js  v1.0.6:contentReference[oaicite:1]{index=1}) {

  /:contentReference[oaicite:2]{index=2}ightbox ---------------- */
  loadJs('https://:contentReference[oaicite:3]{index=3}.js', fu:contentReference[oaicite:4]{index=4}oswipe@5/dist/photoswipe-lightbox.:contentReference[oaicite:5]{index=5}*   ❗保險：:contentReference[oaicite:6]{index=6}       等一輪「requestAnimationFr:contentReference[oaicite:7]{index=7}mationFr:contentReference[oaicite:8]{index=8}hotoSwipe && window.PhotoSwipeLightbox) {
       :contentReference[oaicite:9]{index=9}            // → 真正執行主程式
        } else {
          console.warn('PhotoSwipe still not ready ─ check CDN 路徑是否 200');
        }
      });
    });
  });
:contentReference[oaicite:10]{index=10}具 -------------------------------------- */
  function loadJs(src, cb) {
    var s = document.createElement('script');
    s.src = src;
    s.async = true;
    s.onload = cb;
    document.head.appendChild(s);
  }

})(function () {
  /* === 以下才是主程式（和你 v1.0.5 相同，只有 selector / 版面可再微調） === */

  if (!location.href.includ:contentReference[oaicite:11]{index=11}rn;

  /* 1. 收集圖片 ------------------------------------------------ */
  var imgSet = [];
  $('#projectCarousel .carousel-inner img').each(function () {
    var src = this.src;
    if (src && imgSet.indexOf(src) === -1) imgSet.push(src);
  });
  if (!imgSet.length) return;

  /* 2. 產生 DOM：主圖 + 縮圖列 + 左右鍵 ----------------------- */
  $('#projectCarousel').replaceWith(`
      <div id="psArea" :contentReference[oaicite:12]{index=12}
        <:contentReference[oaicite:13]{index=13}ainImg" src="${imgSet[0]}" style="max-width:500px;cursor:zoom-in">
        <button id="next" class="psBtn psNext">›</button>
        <div id="thumbBar" style="display:flex;gap:8px;justify-content:center;margin-top:6px"></div>
      </div>`);

  imgSet.forEach((src, i) => $('#thumbBar').append(
    `<img class="thumb ${!i ? 'on' : ''}" data-i="${i}" src="${src}"
          style="width:68px;height:68px;object-fit:cover;border:2px solid ${!i ? '#f60' : 'transparent'}">`
  ));

  /* 3. Lightbox ------------------------------------------------ */
  var lightbox = new PhotoSwipeLightbox({
    gallery: '#psArea',
    children: 'img',
    pswpModule: PhotoSwipe              // ← 直接傳入全域 PhotoSwipe 物件
  });
  lightbox.init();

  /* 4. 縮圖 / 左右鍵 / 同步 ----------------------------------- */
  var idx = 0;
  function show(i) {
    idx = i;
    $('#mainImg').attr('src', imgSet[i]);
    $('.thumb').removeClass('on').css('border', '2px solid transparent')
      .eq(i).addClass('on').css('border', '2px solid #f60');
  }
  $('#thumbBar').on('click', '.thumb', e => show(+e.target.dataset.i));
  $('#prev').on('click', () => show((idx - 1 + imgSet.length) % imgSet.length));
  $('#next').on('click', () => show((idx + 1) % imgSet.length));
  $('#mainImg').on('click', () => lightbox.loadAndOpen(idx));
  lightbox.on('change', e => show(e.currIndex));

  /* 5. 版面用的小 CSS ---------------------------------------- */
  var css = document.createElement('style');
  css.textContent = `
    .psBtn{position:absolute;top:50%;transform:translateY(-50%);
           width:40px;height:40px;border-radius:50%;border:none;
           background:#0008;color:#fff;font:26px/40px "arial";cursor:pointer}
    .psNext{right:6px}.psBtn:not(.psNext){left:6px}
    .psBtn:hover{background:#000c}`;
  document.head.appendChild(css);

});
